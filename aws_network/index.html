
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A full featured walkthough of using Django on Zappa (powered by AWS Lambda in serverless environment)">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.6">
    
    
      
        <title>Adventures in Networking - Guide to using Django with Zappa</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.875de78c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-97437653-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adventures-in-networking" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-announce">
          <div class="md-announce__inner md-grid md-typeset">
            
Now Available! Complete video tutorials with my new course: <a
    href="https://www.newline.co/courses/serverless-django-with-zappa/" style="color: #0ee7ff">Newline's Serverless
    Django with Zappa</a>

          </div>
        </aside>
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Guide to using Django with Zappa" class="md-header__button md-logo" aria-label="Guide to using Django with Zappa" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Guide to using Django with Zappa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Adventures in Networking
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/edgarroman/zappa-django-guide/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    edgarroman/zappa-django-guide
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Guide to using Django with Zappa" class="md-nav__button md-logo" aria-label="Guide to using Django with Zappa" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Guide to using Django with Zappa
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/edgarroman/zappa-django-guide/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    edgarroman/zappa-django-guide
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Walkthroughs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Walkthroughs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Walkthroughs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup your Environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_core/" class="md-nav__link">
        Core Django Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_static/" class="md-nav__link">
        Hosting Static Files
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_database/" class="md-nav__link">
        Using a Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_domain/" class="md-nav__link">
        Custom Domains
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_app/" class="md-nav__link">
        Application Adaptations
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        AWS Setup
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="AWS Setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          AWS Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_credentials/" class="md-nav__link">
        Managing Credentials
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_network_primer/" class="md-nav__link">
        Primer on AWS VPC Networking
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Adventures in Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Adventures in Networking
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-but-naive-approach" class="md-nav__link">
    A simple, but naive approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thats-why-amazon-has-vpc" class="md-nav__link">
    That's why Amazon has VPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-essential-vpc-and-subnet-configuration" class="md-nav__link">
    The Essential VPC and Subnet Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-vpc" class="md-nav__link">
    Extending the VPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vpc-patterns" class="md-nav__link">
    VPC Patterns
  </a>
  
    <nav class="md-nav" aria-label="VPC Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vpc-with-a-single-internet-accessible-subnet" class="md-nav__link">
    VPC with a single Internet-Accessible subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-with-a-public-subnet-and-private-subnet" class="md-nav__link">
    VPC with a Public subnet and Private subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-premises-and-internet-accessible-vpc" class="md-nav__link">
    On-Premises and Internet-Accessible VPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-with-an-internal-only-subnet" class="md-nav__link">
    VPC with an Internal-Only subnet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subdividing-the-vpc" class="md-nav__link">
    Subdividing the VPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples-for-walkthroughs" class="md-nav__link">
    Examples for Walkthroughs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-on-redundancy" class="md-nav__link">
    Note on Redundancy
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_database/" class="md-nav__link">
        Creating an RDS Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_route53/" class="md-nav__link">
        Working with Route53
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_acm/" class="md-nav__link">
        AWS Certificate Manager (ACM)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../additional/" class="md-nav__link">
        Additional
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-but-naive-approach" class="md-nav__link">
    A simple, but naive approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thats-why-amazon-has-vpc" class="md-nav__link">
    That's why Amazon has VPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-essential-vpc-and-subnet-configuration" class="md-nav__link">
    The Essential VPC and Subnet Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-vpc" class="md-nav__link">
    Extending the VPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vpc-patterns" class="md-nav__link">
    VPC Patterns
  </a>
  
    <nav class="md-nav" aria-label="VPC Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vpc-with-a-single-internet-accessible-subnet" class="md-nav__link">
    VPC with a single Internet-Accessible subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-with-a-public-subnet-and-private-subnet" class="md-nav__link">
    VPC with a Public subnet and Private subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-premises-and-internet-accessible-vpc" class="md-nav__link">
    On-Premises and Internet-Accessible VPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-with-an-internal-only-subnet" class="md-nav__link">
    VPC with an Internal-Only subnet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subdividing-the-vpc" class="md-nav__link">
    Subdividing the VPC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples-for-walkthroughs" class="md-nav__link">
    Examples for Walkthroughs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-on-redundancy" class="md-nav__link">
    Note on Redundancy
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/edgarroman/zappa-django-guide/edit/master/docs/aws_network.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="adventures-in-networking">Adventures in Networking<a class="headerlink" href="#adventures-in-networking" title="Permanent link">&para;</a></h1>
<p>Presumably, since you've read this far, you're interested in more than a simple Django powered API serving static images.  You probably want something that is more interactive with users and have advanced capabilities.  So this will require interacting with additional AWS services like RDS or DynamoDB for database services, SNS or SQS for task processing, and many more...</p>
<p>Well, there is an important aspect about interacting with additional AWS services.  With pure AWS lambda, we have a fairly low attack surface, but when we introduce additional interactions over the network, we must consider information security risks and our network architecture.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section assumes some familarity with the basic concepts within AWS VPC.  If you aren't comfortable with these concepts,
then head over to a <a href="../aws_network_primer/">Primer on AWS VPC Networking</a></p>
</div>
<h2 id="a-simple-but-naive-approach">A simple, but naive approach<a class="headerlink" href="#a-simple-but-naive-approach" title="Permanent link">&para;</a></h2>
<p>A simple approach would be to create an AWS RDS instance that is open to the Internet and have your lambda Django project login directly.  While this may work, this approach is fraught with peril.  Numerous vulnerabilities could exist and credentials could be discovered by brute force.  Even without gaining access to your RDS, it is trivial to launch a denial-of-service attack to ensure your Django project has no database services.</p>
<p>Basically, do not do this.</p>
<h2 id="thats-why-amazon-has-vpc">That's why Amazon has VPC<a class="headerlink" href="#thats-why-amazon-has-vpc" title="Permanent link">&para;</a></h2>
<p>Introducing AWS Virtual Private Cloud (VPC).  This service provides a way of segmenting Internet traffic from your other AWS services.  This feature is incredibly valuable to securing our project, so that bad guys have the smallest attack surface possible.  </p>
<p>Once a VPC is established, you can then subdivide the VPC into subnets.  Which are little non-overlapping IP chunks of the overall VPC.  Like dividing a pie into slices.</p>
<p>It is important to realize that you have almost entire control of your IP space when you define your VPC and associated subnets.  You are creating a Software Defined Network (SDN) and you have a lot of leeway.  With this freedom comes choices and important considerations on how you design your network.</p>
<h2 id="the-essential-vpc-and-subnet-configuration">The Essential VPC and Subnet Configuration<a class="headerlink" href="#the-essential-vpc-and-subnet-configuration" title="Permanent link">&para;</a></h2>
<p>Here is the absolute minimum you must have to have a working Django site within a VPC:</p>
<ul>
<li>A VPC</li>
<li>A subnet within the VPC</li>
<li>A security group</li>
<li>Your zappa project configured to use the subnet and security group</li>
</ul>
<p>There are no need for routes, NAT gateways, Internet gateways, or even allowing inbound rules on the security group.  You will probably need many of these services eventually for a robust and full-featured application, but for illustration purposes now, we will keep it simple.</p>
<p>You may be asking yourself how will traffic from the Internet reach the lambda function. Well essentially the magic is in the API Gateway that zappa creates on deployment.  From the <a href="https://aws.amazon.com/api-gateway/faqs/">API Gateway FAQ</a>:</p>
<blockquote>
<p>Amazon API Gateway endpoints are always public to the Internet. Proxy requests to backend operations also need to be publicly accessible on the Internet. However, you can generate a client-side SSL certificate in Amazon API Gateway to verify that requests to your backend systems were sent by API Gateway using the public key of the certificate.</p>
</blockquote>
<p>So API Gateways act as an 'always-on' Internet facing service that sends the HTTP requests to the Zappa Lambda functions by creating 
Lambda events.  These events can reach your zappa application even if deployed in a top-secret lockbox.  Note that in the above VPC setup the Lambda function is completely isolated from direct access to the Internet.  Thus the Lambda functions can't make outbound connections to anything: other servers, databases, S3, etc.</p>
<p>Let's face it, there's no real point to going through the effort of doing this if the Lambda functions are really this isolated.<br />
<em>But</em> the reason this information is important is because in order to leverage other AWS resources, 
the VPC lays the foundation to do this securely.</p>
<h2 id="extending-the-vpc">Extending the VPC<a class="headerlink" href="#extending-the-vpc" title="Permanent link">&para;</a></h2>
<p>To re-iterate: we don't need a VPC network to make the Zappa Lambda-powered Django site visible on the Internet.<br />
We need to extend the VPC so that we can add more AWS services like:</p>
<ul>
<li>Adding an RDS database that is only accessible from our Lambda functions</li>
<li>Adding an S3 bucket </li>
<li>Allowing Lambda functions to communicate to traditional EC2 instances for long running processes</li>
<li>Allowing the Lambda functions to access the Internet to hit an external API</li>
<li>Ability to interact with SQS and/or SNS</li>
</ul>
<p>The important thing is that we can enable all these scenarios in a secure manner.  There are too many scenarios to go into detail here, so we will provide some guidelines.</p>
<p>Next we learn about the common patterns of VPC usage and try to identify usage options.</p>
<p>One warning before we go on with VPC subnet sizing and Lambda:  When Lambda functions fire, they must be assigned an IP address temporarily.  If you have a lot of Lambda functions firing, then you must have a lot of IP addresses available in your subnet.  You can learn more <a href="http://docs.aws.amazon.com/lambda/latest/dg/vpc.html#vpc-setup-guidelines">here</a>.</p>
<h2 id="vpc-patterns">VPC Patterns<a class="headerlink" href="#vpc-patterns" title="Permanent link">&para;</a></h2>
<p>While the actual VPC itself is very straightforward, the combination of subnets within the VPC can take many forms.  Additionally, you must consider how the subnets will communicate among themselves as well as how  they communicate with outside networks. For a more comprehensive list of options and other valuable information about VPCs, see this link: <a href="https://aws.amazon.com/answers/networking/aws-single-vpc-design/">https://aws.amazon.com/answers/networking/aws-single-vpc-design/</a></p>
<p>The options are summarized here:</p>
<h3 id="vpc-with-a-single-internet-accessible-subnet">VPC with a single Internet-Accessible subnet<a class="headerlink" href="#vpc-with-a-single-internet-accessible-subnet" title="Permanent link">&para;</a></h3>
<p>This pattern places your lambda functions, your RDS, and additional SNS/SQS services in a single subnet that is Internet accessible in your VPC.  In theory you could configure your security groups to ensure only lambda functions can hit your RDS.</p>
<p>One advantage of this setup is that you can setup your local machine to connect to your RDS without a <a href="http://serverfault.com/a/648116/60094">bastion host</a>.  Just restrict access based on IP.  </p>
<p>Important note - you will want to ensure careful inbound IP restrictions.  While it's great that you can connect to RDS with your SQL desktop client, you should setup a <a href="(http://serverfault.com/a/648116/60094)">bastion host</a>.</p>
<p>Also note that your zappa deployment 
<a href="../aws_network_primer/#general-behavior-and-internet-access">will not have outbound access to the Internet</a>.
In order to do this you will have use a Public/Private setup.</p>
<p>Some additional considerations from the AWS Documentation</p>
<div class="admonition quote">
<p class="admonition-title">Some additional considerations from the <a href="http://docs.aws.amazon.com/lambda/latest/dg/vpc.html#vpc-configuring">AWS Documentation</a></p>
<ul>
<li>
<p>We recommend that you avoid DNS resolution of public host names for your VPC. This can take several seconds to resolve, which adds several seconds of billable time on your request. For example, if your Lambda function accesses an Amazon RDS instance in your VPC, launch the instance with the no-publicly-accessible option.</p>
</li>
<li>
<p>When you add VPC configuration to a Lambda function, it can only access resources in that VPC. If a Lambda function needs to access both VPC resources and the public Internet, the VPC needs to have a Network Address Translation (NAT) instance inside the VPC.</p>
</li>
<li>
<p>When a Lambda function is configured to run within a VPC, it incurs an additional ENI start-up penalty. This means address resolution may be delayed when trying to connect to network resources.</p>
</li>
</ul>
</div>
<p><strong>This scenario is good for straightforward setups with a little work, but has significant limitations</strong></p>
<h3 id="vpc-with-a-public-subnet-and-private-subnet">VPC with a Public subnet and Private subnet<a class="headerlink" href="#vpc-with-a-public-subnet-and-private-subnet" title="Permanent link">&para;</a></h3>
<p>Arguably the most flexible and future-proof of all web application setups.  You have two subnets: one public and one private.  Your RDS and lambda functions reside in the private subnet, far away from bad guys, but also far away from your local machine.  In order to access the database from your system you will need a <a href="http://serverfault.com/a/648116/60094">bastion host</a> in the public subnet.  </p>
<p>Another advantage of this setup is that if you ever want to add additional EC2-based services that need to interact with the Internet you can do this very easily without compromising security.  </p>
<p>Generally this setup will require networking knowledge to setup the Internet gateway, bastion host, and NAT Gateway.</p>
<p><strong>The upshot is this configuration is the most secure and most flexible for your growth but will be complex from a network standpoint</strong></p>
<h3 id="on-premises-and-internet-accessible-vpc">On-Premises and Internet-Accessible VPC<a class="headerlink" href="#on-premises-and-internet-accessible-vpc" title="Permanent link">&para;</a></h3>
<p>Same as the last configuration, but if you have an internal corporate network to connect, you can easily establish a connection to the private subnet without compromising security.</p>
<p>If you thought the last setup was complex, you better know what you are doing from a network standpoint.</p>
<p><strong>A good solution if you need to connect an internal corporate network</strong></p>
<h3 id="vpc-with-an-internal-only-subnet">VPC with an Internal-Only subnet<a class="headerlink" href="#vpc-with-an-internal-only-subnet" title="Permanent link">&para;</a></h3>
<p>Obviously a very special case of creating a Django app for internal use only with no desire to have it accessible by the Internet.</p>
<p>This is actually most secure.  Since you can access any of the resources from your desktop on the internal network.  Not bad for the paranoid or security conscious devops team.</p>
<p><strong>Useful for the simple environment if you have an existing secure network</strong></p>
<h2 id="subdividing-the-vpc">Subdividing the VPC<a class="headerlink" href="#subdividing-the-vpc" title="Permanent link">&para;</a></h2>
<p>Once you get a VPC selected you must create subnets within the VPC.  When defining a subnet, you just have to pick a non-overlapping segment of the ip range.  So if you have VPC that spans IP address 10.5.0.1 to 10.5.0.254, then you pick contiguous segments within this range.</p>
<p>See more details in <a href="../aws_network_primer/">Primer on AWS VPC Networking</a></p>
<h2 id="examples-for-walkthroughs">Examples for Walkthroughs<a class="headerlink" href="#examples-for-walkthroughs" title="Permanent link">&para;</a></h2>
<p>For the purposes of walkthroughs, we will leverage a simple VPC with a single subnet.  A single subnet will generally be enough to guide readers through the scenarios.</p>
<p>We have a VPC:</p>
<ul>
<li>id: vpc-9a9a1dfc</li>
<li>cidr: 10.6.0.0/16</li>
</ul>
<p>With subnet:</p>
<ul>
<li>id: subnet-f3446aba</li>
<li>cidr: 10.6.1.0/24</li>
</ul>
<p>And security group:</p>
<ul>
<li>id: sg-13a5736f</li>
<li>inbound rules: none</li>
<li>outbound rules: all traffic</li>
</ul>
<blockquote>
<p>TODO: Show example zappa configuration here</p>
</blockquote>
<h2 id="note-on-redundancy">Note on Redundancy<a class="headerlink" href="#note-on-redundancy" title="Permanent link">&para;</a></h2>
<p>While these examples are all using a single subnet for clarity, in production you will want to create multiple subnets within the VPC all with different availability zones.  This ensures if there is a failure within a single availability zone, there are alternate paths.  </p>
<p>The general approach is to associate the Lambda functions with multiple subnets and the AWS resources with the same multiple subnets (e.g. RDS).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../aws_network_primer/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Primer on AWS VPC Networking
            </div>
          </div>
        </a>
      
      
        <a href="../aws_database/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Creating an RDS Database
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; <script>document.write(new Date().getFullYear())</script> <a href="https://github.com/edgarroman">Edgar Roman</a>
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/edgarroman" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.34eae1b6.min.js"></script>
      
    
  </body>
</html>